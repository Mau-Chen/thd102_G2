<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    @@include('layout/meta.html')
    <link rel="stylesheet" href="./css/style.css" />
    <title>Go結帳 | PetpaGo</title>
    <link href="/images/pgo.ico" rel="icon" />
</head>

<body>
    <div class="wrapper shopping bg_gray">
        @@include('layout/header.html')
        <div class="sp_container" id="spApp">
            <!--進度條-->
            <div class="spStep_bg">
                <div class="spStep_box col-10 col-sm-12">
                    <button v-for="(step, index) in steps" :key="index" class="spStep"
                        :class="{ 'jsNow': index <= currentStep }" @click="setCurrentStep(index)" type="button"
                        :disabled="index > currentStep">
                </div>
            </div>
            <div class="spMain_bg">
                <form class="sp_form">
                    <!--步驟一內容-->
                    <div class="spPage" :class="{'jsNow':currentStep === 0}">
                        <div class="spMain_wrapper">
                            <h5 class="spMian_title">您的購物車</h5>
                            <div class="spMain">
                                <div class="spMain_left col-7 col-lg-12">
                                    <div class="spCard">
                                        <!-- 用 v-model 與 checked 綁定，控制全選的狀態。@change監聽變化並呼叫 allChecked 函數。 -->
                                        <input type="checkbox" v-model="checked" @change="allChecked">
                                        <label>
                                            <div>全選</div>
                                        </label>
                                    </div>
                                    <!-- 使用 v-for 為每個項目應用CSS類別。 -->
                                    <div v-for="(item, index) in shoppingItems" :key="index"
                                        :class="['spCard', item.type]">
                                        <div class="spCard_up">
                                            <!-- checkbox與 checkedNames 綁定，記錄選中的商品。 -->
                                            <input type="checkbox" :value="item.id" v-model="checkedNames">
                                            <label>
                                                <picture>
                                                    <source :srcset="item.pictureSrc_m" media="(max-width: 414px)">
                                                    <img :src="item.pictureSrc">
                                                </picture>
                                            </label>
                                            <div class="spBuy_text">
                                                <div class="spList_up">
                                                    <h6>{{ item.product }}</h6>
                                                    <!-- 綁定確認刪除事件 -->
                                                    <img src="images/icon/shop-icon/delete.svg"
                                                        @click="confirmDelete(index)">
                                                </div>
                                                <div class="spList_down">
                                                    <p>{{ useDate(item) }}</p>
                                                    <p v-if="item.listType === '狗套房'">{{ item.listType }} ｜ {{
                                                        item.dogSize}}</p>
                                                    <p v-else>{{ item.listType }}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="spSubtotal">
                                            <!-- 是否有 spStepper 屬性，顯示加減按鈕 -->
                                            <div v-if="item.spStepper">
                                                <div class="spStepper">
                                                    <!-- updateAmount、updateSubtotal:增減數量並更新小計 -->
                                                    <div class="spSubtotal_icon" @click="updateAmount(item, -1)"
                                                        :class="{ 'limit': item.BuyNum === 1 }">
                                                        <svg width="11" height="3" viewBox="0 0 11 3" fill="none"
                                                            xmlns="http://www.w3.org/2000/svg">
                                                            <path
                                                                d="M10.3125 0.875H0.6875C0.441406 0.875 0.25 1.09375 0.25 1.3125V2.1875C0.25 2.43359 0.441406 2.625 0.6875 2.625H10.3125C10.5312 2.625 10.75 2.43359 10.75 2.1875V1.3125C10.75 1.09375 10.5312 0.875 10.3125 0.875Z"
                                                                fill="#E6E6E6" />
                                                        </svg>
                                                    </div>
                                                    <input type="number" v-model="item.BuyNum"
                                                        @input="handleInput(item)">
                                                    <div class="spSubtotal_icon" @click="updateAmount(item, 1)"
                                                        :class="{ 'limit': item.BuyNum === 9 }">
                                                        <svg width="11" height="11" viewBox="0 0 11 11" fill="none"
                                                            xmlns="http://www.w3.org/2000/svg">
                                                            <path
                                                                d="M10.3125 4.875H6.375V0.9375C6.375 0.71875 6.15625 0.5 5.9375 0.5H5.0625C4.81641 0.5 4.625 0.71875 4.625 0.9375V4.875H0.6875C0.441406 4.875 0.25 5.09375 0.25 5.3125V6.1875C0.25 6.43359 0.441406 6.625 0.6875 6.625H4.625V10.5625C4.625 10.8086 4.81641 11 5.0625 11H5.9375C6.15625 11 6.375 10.8086 6.375 10.5625V6.625H10.3125C10.5312 6.625 10.75 6.43359 10.75 6.1875V5.3125C10.75 5.09375 10.5312 4.875 10.3125 4.875Z"
                                                                fill="#5E5E5E" />
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 小計的金額用函數 countSubtotal(item) 計算 -->
                                            <p>NT${{ countSubtotal(item).toLocaleString('en-US') }}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="spMain_right col-5 col-lg-12">
                                    <div class="spCard">
                                        <div class="spTotal mb_32">
                                            <!-- totalItems 和 totalPrice 分別計算總件數和總＄。 -->
                                            <p>{{ this.checkedNames.length }}件總計</p>
                                            <h5>NT${{ totalPrice.toLocaleString('en-US') }}</h5>
                                        </div>
                                        <button class="spNext btn_5 jsNext" type="button"
                                            @click="caculate_point();currentStep ++">下一步</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @@include('layout/ad.html')
                    </div>
                    <!--步驟二內容-->
                    <div class="spPage sp2" :class="{'jsNow':currentStep === 1}">
                        <h5 class="spMian_title">聯絡資料</h5>
                        <div class="spMain">
                            <!-- 左內容 -->
                            <div class="spMain_left col-7">
                                <div class="spCard spOrderMan">
                                    <p>姓名：<span>*</span></p>
                                    <input type="text" placeholder="請輸入姓名" :value="sameMemberChecked ? spOrderName : ''"
                                        required>
                                    <p>電子信箱：<span>*</span></p>
                                    <input type="text" placeholder="請輸入Email"
                                        :value="sameMemberChecked ? spOrderEmail.value : ''" required>
                                    <p>行動電話：<span>*</span></p>
                                    <input type="number" placeholder="請輸入行動電話"
                                        :value="sameMemberChecked ? spOrderPhone : ''"
                                        required :maxlength="10">
                                    <!-- 限制只可輸入數字 -->
                                    <div class="spSame_member">
                                        <input type="checkbox" v-model="sameMemberChecked">
                                        <label>同會員資料</label>
                                    </div>
                                    <p>備註：</p>
                                    <textarea rows="3" placeholder="請輸入寵物品種/須注意事項/特殊需求"></textarea>
                                </div>
                                <h5 class="mb_32">優惠折扣</h5>
                                <div class="spCard">
                                    <div class="spOrder_check">
                                        <input type="checkbox">
                                        <label>我要使用 Pet Points</label>
                                    </div>
                                    <!-- <p>可用 Pet Points <span>{{ havePoints }}</span> 點，最多使用<input type="number"
                                            id="usePoint" v-model="canUsePoints" :max="canUsePoints">點</p> -->
                                    <p>可用 Pet Points <span>{{ havePoints }}</span> 點，最多使用<input type="number"
                                            id="usePoint" v-model="usePoints" @input="handlePoints"
                                            :placeholder="canUsePoints">點</p>
                                </div>
                                <div class="spPay mb_32">
                                    <h5>信用卡/簽帳金融卡付款</h5>
                                    <span><img src="images/icon/shop-icon/mastercard.svg" alt=""><img
                                            src="images/icon/shop-icon/visa.svg" alt=""><img
                                            src="images/icon/shop-icon/ae.svg" alt=""><img
                                            src="images/icon/shop-icon/jcb.svg" alt=""></span>
                                </div>
                                <div class="spCard">
                                    <div class="creditCard">
                                        <div class="col-4 col-lg-12">
                                            <p>信用卡號碼<span>*</span></p>
                                            <div>
                                                <input type="text" ref="input1" maxlength="4" placeholder="0000"
                                                    @input="handleCC(1, 4)" v-model="cardNumber[0]" required>
                                                <input type="text" ref="input2" maxlength="4" placeholder="0000"
                                                    @input="handleCC(2, 4)" v-model="cardNumber[1]" required>
                                                <input type="text" ref="input3" maxlength="4" placeholder="0000"
                                                    @input="handleCC(3, 4)" v-model="cardNumber[2]" required>
                                                <input type="text" ref="input4" maxlength="4" placeholder="0000"
                                                    @input="handleCC(4, 4)" v-model="cardNumber[3]" required>
                                            </div>
                                        </div>
                                        <div class="col-4 col-lg-12">
                                            <p>有效期限<span>*</span></p>
                                            <div>
                                                <input type="text" ref="input5" maxlength="2" placeholder="MM"
                                                    @input="handleCC(5, 2)" v-model="cardExpiration[0]" required>
                                                /<input type="text" ref="input6" maxlength="2" placeholder="YY"
                                                    @input="handleCC(6, 2)" v-model="cardExpiration[1]" required>
                                            </div>
                                        </div>
                                        <div class="col-4 col-lg-12">
                                            <p>背面後3碼<span>*</span></p>
                                            <input type="text" placeholder="CVC/CVV" maxlength="3" minlength="3"
                                                ref="input7" @input="handleCC(7, 3)" v-model="cardCVC" required>
                                        </div>
                                    </div>
                                    <p>請注意本平台不會向您收取任何平台交易手續費，但你下單時使用的信用卡可能會向您收取相關手續費， 請參考其相關服務政策和規定，並向你所選的交易服務商取得更多資訊。
                                    </p>
                                </div>
                            </div>
                            <!-- 總計 -->
                            <div class="spMain_right col-5">
                                <div class="spCard">
                                    <div class="spBuy_text" v-for="(item, index) in shoppingItems" :key="index">
                                        <div class="spList_up">
                                            <h6>{{ item.product }}</h6>
                                        </div>
                                        <div class="spList_down">
                                            <p>{{ useDate(item) }}</p>
                                            <div>
                                                <p v-if="item.listType === '狗套房'">{{ item.listType }} ｜ {{ item.dogSize
                                                    }}
                                                </p>
                                                <p v-else>{{ item.listType }}</p>
                                                <p>NT${{ countSubtotal(item).toLocaleString('en-US') }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="spBuy_text spCount">
                                        <div>
                                            <p>{{ this.checkedNames.length }}件合計</p>
                                            <p>NT${{ totalPrice.toLocaleString('en-US') }}</p>
                                        </div>
                                        <div>
                                            <p>Pet Points 折抵</p>
                                            <p>-NT$ {{ usePoints }}</p>
                                        </div>
                                    </div>
                                    <div class="spTotal">
                                        <p>{{ this.checkedNames.length }}件總計</p>
                                        <h5>NT${{payPrice}}</h5>
                                    </div>
                                    <button class="spNext btn_5 jsNext" type="button"
                                        @click="currentStep ++ ">下一步</button>
                                    <div>
                                        <img src="images/icon/member-icon/black-points.svg" alt="">
                                        <p>可獲得 Pet Points <span>{{Math.floor((payPrice)/100)}}</span> 點</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--步驟三內容-->
                    <div class="spPage" :class="{'jsNow':currentStep === 2}">
                        <div class="spMain sp3">
                            <div class="mb_32">
                                <img src="images/icon/components-icon/success.svg" alt="">
                                <h5>訂單完成</h5>
                                <p>訂單資料將寄送至：service@tibame.com</p>
                            </div>
                            <div class="spCard">
                                <ul>
                                    <li class="accordion">
                                        <!-- first list box1 -->
                                        <div class="ol-header mb_24">
                                            <div class="ol-headText">
                                                <p>訂單日期：2023年8月4日</p>
                                                <p>訂單編號：PT0004</p>
                                            </div>
                                        </div>
                                        <!-- first list box2 -->
                                        <div class="ol-content mb_24">
                                            <!-- box2-1 -->
                                            <div class="ol-contentBox mb_24">
                                                <img src="/images/pic/shop/goShop01.png" alt="driveDog">
                                                <div class="ol-ContText">
                                                    <h6 class="mb_16">寵物接送</h6>
                                                    <p>8月17日 ｜ 16:00</p>
                                                    <div class="ol-info">
                                                        <p>轎車</p>
                                                        <p>NT$ 300</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- box2-2 -->
                                            <div class="ol-contentBox mb_24">
                                                <img src="/images/pic/shop/goShop02.png" alt="driveDog">
                                                <div class="ol-ContText">
                                                    <h6 class="mb_16">快樂寵物旅館</h6>
                                                    <p>8月17日-8月19日 (3晚)</p>
                                                    <div class="ol-info">
                                                        <p>狗套房X1 ｜ 小型犬</p>
                                                        <p>NT$ 2,400</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- box2-3 -->
                                            <div class="ol-contentBox mb_24">
                                                <img src="/images/pic/shop/goShop03.png" alt="driveDog">
                                                <div class="ol-ContText">
                                                    <h6 class="mb_16">快樂寵物旅館</h6>
                                                    <p>8月17日-8月19日 (3晚)</p>
                                                    <div class="ol-info">
                                                        <p>貓套房X1 ｜ 貓咪</p>
                                                        <p>NT$ 2,400</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- first list box3 -->
                                        <div class="ol-money mb_24">
                                            <div class="ol-count mb_16">
                                                <p>3件合計</p>
                                                <span>NT$ 5,100</span>
                                            </div>
                                            <div class="ol-count">
                                                <p>Pet Points 折抵</p>
                                                <span>-NT$ 30</span>
                                            </div>
                                        </div>
                                        <!-- first list box4 -->
                                        <div class="ol-total">
                                            <div class="ol-count mb_24">
                                                <p>總計</p>
                                                <span>NT$ 5,070</span>
                                            </div>
                                            <p><img src="/images/icon/member-icon/black-points.svg"
                                                    alt="points-icon">已獲得 Pet Points
                                                <span>50</span> 點
                                            </p>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="spCard OrderMan">
                                <div>
                                    <p>姓名</p>
                                    <p>王緯育</p>
                                </div>
                                <div>
                                    <p>電子信箱</p>
                                    <p>service@tibame.com</p>
                                </div>
                                <div>
                                    <p>行動電話</p>
                                    <p>0912-345-678</p>
                                </div>
                            </div>
                            <button class="btn_5 btn-success" type="button" id="Go_index"
                                @click="goToIndex">回首頁</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        @@include('layout/footer.html')
    </div>


    <script>
        const app = Vue.createApp({
            data() {
                return {
                    currentStep: 0,
                    steps: ["查看購物車", "填寫資料", "完成付款"],
                    checked: false,
                    checkedNames: [],
                    spOrderName: '王緯育',
                    spOrderEmail: {
                        value: 'service@tibame.com', // 初始Email
                        isValid: true, // 是否有效，預設有效
                    },
                    spOrderPhone: '0912345678',
                    sameMemberChecked: false,
                    havePoints: 7000,
                    usePoints: 0,

                    cardNumber: ['', '', '', ''],
                    cardExpiration: ['', ''],
                    cardCVC: '',
                    isStepTwoValid: false,
                    validationErrors: [],
                    // valNew: "",
                    shoppingItems: [
                        {
                            id: "Car",
                            type: "spDriver",
                            pictureSrc_m: "images/pic/shop/goShop01_m.png",
                            pictureSrc: "images/pic/shop/goShop01.png",
                            product: "寵物接送",
                            listType: "轎車",
                            spStepper: false,
                            spPrice: 300,
                            BuyNum: 1,
                            listDate_S: "8/17",
                            listDate_E: "8/17",
                            listDate_T: "16:00",
                        },
                        {
                            id: "Hostel1",
                            type: "spHostel",
                            pictureSrc_m: "images/pic/shop/goShop02_m.png",
                            pictureSrc: "images/pic/shop/goShop02.png",
                            product: "快樂寵物旅館",
                            listType: "狗套房",
                            dogSize: "小型犬",
                            spStepper: true,
                            spPrice: 800,
                            BuyNum: 1,
                            listDate_S: "8/17",
                            listDate_E: "8/20",
                            listDate_T: "16:00",
                        },
                        {
                            id: "Hostel2",
                            type: "spHostel",
                            pictureSrc_m: "images/pic/shop/goShop03_m.png",
                            pictureSrc: "images/pic/shop/goShop03.png",
                            product: "快樂寵物旅館",
                            listType: "貓套房",
                            spStepper: true,
                            spPrice: 800,
                            BuyNum: 1,
                            listDate_S: "8/17",
                            listDate_E: "8/20",
                            listDate_T: "16:00",
                        },
                    ],
                };
            },
            // 預設全選。
            mounted() {
                this.checked = true;
                this.checkedNames = this.shoppingItems.map(item => item.id);

                let nextButton = document.getElementById('Go_index');
                nextButton.addEventListener('click', () => {
                    window.location.href = 'index.html';
                });
            },
            methods: {
                caculate_point() {
                    this.usePoints = this.totalPrice * 0.2
                },
                setCurrentStep(index) {
                    this.currentStep = index;
                },
                // 切換全選狀態。如果checked為true，則將checkedNames設置為所有購物項目的ID，否則將其清空。
                allChecked() {
                    if (this.checked) {
                        this.checkedNames = this.shoppingItems.map((item) => item.id);
                    } else {
                        this.checkedNames = [];
                    }
                },
                // 格式化日期資訊，顯示成特定的格式
                useDate(item) {
                    if (item.spStepper) {
                        item.listDate_D = Math.round((new Date(item.listDate_E) - new Date(item.listDate_S)) / (1000 * 60 * 60 * 24));
                        const formattedStartDate = this.formatDate(item.listDate_S);
                        const formattedEndDate = this.formatDate(item.listDate_E);
                        return `${formattedStartDate} - ${formattedEndDate} (${item.listDate_D}晚)`;
                    } else {
                        const formattedDate = this.formatDate(item.listDate_S);
                        return `${formattedDate} ｜ ${item.listDate_T}`;
                    }
                },
                updateSubtotal(item) {
                    if (item.spStepper) {
                        item.listDate_D = Math.round((new Date(item.listDate_E) - new Date(item.listDate_S)) / (1000 * 60 * 60 * 24));
                        item.spSubtotal = item.spPrice * item.BuyNum * item.listDate_D;
                    } else {
                        item.listDate_D = 1;
                        item.spSubtotal = item.spPrice * item.BuyNum * item.listDate_D;
                    }
                },
                // 計算小計(單價、數量和天數)
                countSubtotal(item) {
                    if (item.spStepper) {
                        item.listDate_D = Math.round((new Date(item.listDate_E) - new Date(item.listDate_S)) / (1000 * 60 * 60 * 24));
                        return item.spPrice * item.BuyNum * item.listDate_D;
                    } else {
                        item.listDate_D = 1;
                        return item.spPrice * item.BuyNum * item.listDate_D;
                    }
                },
                // 更新數量，更新小計。
                updateAmount(item, change) {
                    if (item.BuyNum < 9) {
                        item.BuyNum = Math.max(1, item.BuyNum + change);
                    } else if (item.BuyNum >= 9) {
                        item.BuyNum = 8;
                        item.BuyNum = Math.max(1, item.BuyNum + change);
                    }
                    this.updateSubtotal(item);
                },
                // 限制輸入在1～9之間
                handleInput(item) {
                    if (item.BuyNum < 1) {
                        item.BuyNum = 1;
                    } else if (item.BuyNum > 9) {
                        item.BuyNum = 9;
                    }
                    this.updateSubtotal(item);
                },
                // 格式化日期
                formatDate(dateStr) {
                    const [month, day] = dateStr.split('/');
                    return `${Number(month)}月${Number(day)}日`;
                },
                // 確認是否移除
                confirmDelete(index) {
                    const isConfirmed = confirm("確認移除嗎？");
                    if (isConfirmed) {
                        // 點擊後刪除當前.spCard
                        this.shoppingItems.splice(index, 1);
                        // 引用整理索引
                        this.updateIndex();
                    }
                },
                // 重新整理索引值
                updateIndex() {
                    this.shoppingItems.forEach((item, index) => {
                        item.index = index;
                    });
                },
                goToIndex() {
                    window.location.href = 'index.html';
                },
                //信用卡焦點改變
                handleCC(index, lengthToCheck) {
                    const inputElement = this.$refs[`input${index}`];
                    const inputValue = inputElement.value;

                    const pattern = /^[0-9]*$/;
                    if (!pattern.test(inputValue)) {
                        inputElement.value = '';
                        return;
                    }

                    if (inputValue.length === lengthToCheck && index < 7) {
                        this.$refs[`input${index + 1}`].focus();
                    } else if (inputValue.length === 0 && index > 1) {
                        this.$refs[`input${index - 1}`].focus();
                    }
                },
                handlePoints(usePoints) {
                    this.usePoints = Math.min(Math.max(this.usePoints, 0), this.canUsePoints);
                },
                // updateMaxPointsToUse(event) {
                //     const inputValue = parseInt(event.target.value);
                //     if (!isNaN(inputValue) && inputValue <= this.havePoints) {
                //         this.canUsePoints = inputValue;
                //     }
                // },

            },
            computed: {
                // 計算總件數
                // totalItems() {
                //     return this.checkedNames.length;
                // },
                // 計算總價格。
                totalPrice() {
                    return this.shoppingItems.reduce((total, item) => {
                        if (this.checkedNames.includes(item.id)) {
                            return total + this.countSubtotal(item);
                        }
                        return total;
                    }, 0);
                },
                canUsePoints() {
                    const max = this.countSubtotal(this.shoppingItems[0]) * 0.2;
                    return this.havePoints <= max ? this.havePoints : max;
                },
                payPrice() {
                    return this.totalPrice - this.usePoints;
                },
            },
            watch: {
                // 監視checkedNames的變化。若所有都被選，checked為true，否為false。
                checkedNames(val) {
                    this.checked = val.length === this.shoppingItems.length;
                }
            },
        });

        app.mount('#spApp');






        //第三頁按鈕回到首頁
        // document.addEventListener('DOMContentLoaded', function () {
        //     let nextButton = document.getElementById('Go_index');
        //     nextButton.addEventListener('click', function () {
        //         window.location.href = 'index.html';
        //     });
        // });

        // DOM 元素
        const DOMstrings = {
            //辨識步驟按鈕
            stepsBtnClass: 'spStep',
            //取得所有.spStep
            stepsBtns: document.querySelectorAll('.spStep'),
            //辨識進度條區塊
            stepsBox: document.querySelector('.spStep_box'),
            //辨識表單容器
            stepsForm: document.querySelector('.sp_form'),
            //辨識頁面
            stepFormPageClass: 'spPage',
            stepFormPanels: document.querySelectorAll('.spPage'),
            stepNextBtnClass: 'jsNext'
        };

        // 定意函式（從一組元素中移除class）
        const removeClasses = (arraySet, className) => {
            arraySet.forEach(e => {
                e.classList.remove(className);
            });
        };

        // 找到指定class的父層
        const findParent = (e1, parentClass) => {
            let nowNode = e1;
            while (!(nowNode.classList.contains(parentClass))) {
                nowNode = nowNode.parentNode;
            }
            return nowNode;
        };

        // 得到當前的步驟按鈕索引
        const getNowStep = e2 => {
            return Array.from(DOMstrings.stepsBtns).indexOf(e2);
        };

        // 設置所有被點擊之前（包括被點擊的）的步驟按鈕為活動狀態
        const setActiveStep = (activeStepNum) => {
            // 移除所有class=jsNow
            removeClasses(DOMstrings.stepsBtns, 'jsNow');

            // 被選取的項目加上class=jsNow
            DOMstrings.stepsBtns.forEach((e3, index) => {
                if (index <= activeStepNum) {
                    e3.classList.add('jsNow');
                }
            });
        };

        // 找到有jsNow，交給activePanel
        const getActivePage = () => {
            let activePanel;
            DOMstrings.stepFormPanels.forEach(e4 => {
                if (elem.classList.contains('jsNow')) {
                    activePanel = e4;
                }
            });
            return activePanel;
        };

        // 打開活動的面板（並關閉非活動的面板）
        const setActivePanel = activePanelNum => {
            // 移除所有面板的活動類別
            removeClasses(DOMstrings.stepFormPanels, 'jsNow');

            // 顯示活動的面板
            DOMstrings.stepFormPanels.forEach((elem, index) => {
                if (index === activePanelNum) {
                    elem.classList.add('jsNow');
                    setFormHeight(elem);
                }
            });
        };

        // 將表單高度設置為當前面板的高度
        const formHeight = (activePanel) => {
            const activePanelHeight = activePanel.offsetHeight;
            DOMstrings.stepsForm.style.height = `${activePanelHeight}px`;
        };

        const setFormHeight = () => {
            const activePanel = getActivePage();
            formHeight(activePanel);
        };

        // 點擊步驟進度條的功能
        DOMstrings.stepsBox.addEventListener('click', e => {
            // 檢查點擊目標是否為步驟按鈕
            const eventTarget = e.target;
            if (!eventTarget.classList.contains(`${DOMstrings.stepsBtnClass}`)) {
                return;
            }
            // 獲取活動的步驟按鈕的序號
            const activeStep = getNowStep(eventTarget);
            // 設置所有被點擊之前（包括被點擊的）的步驟按鈕為活動狀態
            setActiveStep(activeStep);
            // 打開活動的面板
            setActivePanel(activeStep);
        });

        // 點擊“上一步”和“下一步”按鈕的功能
        DOMstrings.stepsForm.addEventListener('click', e => {
            const eventTarget = e.target;
            // 檢查是否點擊了“上一步”或“下一步”按鈕
            if (!((eventTarget.classList.contains(`${DOMstrings.stepPrevBtnClass}`)) || (eventTarget.classList.contains(`${DOMstrings.stepNextBtnClass}`)))) {
                return;
            }
            // 找到活動的面板
            const activePanel = findParent(eventTarget, `${DOMstrings.stepFormPageClass}`);
            let activePanelNum = Array.from(DOMstrings.stepFormPanels).indexOf(activePanel);

            // 根據點擊的按鈕設置活動步驟和活動面板
            if (eventTarget.classList.contains(`${DOMstrings.stepPrevBtnClass}`)) {
                activePanelNum--;
            } else {
                activePanelNum++;
            }
            // setActiveStep(activePanelNum);
            // setActivePanel(activePanelNum);
        });

        // 在頁面載入時設置正確的表單高度
        window.addEventListener('load', setFormHeight, false);

        // 在窗口大小調整時設置正確的表單高度
        window.addEventListener('resize', setFormHeight, false);



    </script>

</body>

</html>